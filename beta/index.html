<!DOCTYPE html>
<html lang="de">
<head>
	<title>Gesundbrunnen Raid Tool</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="refresh" content="43200">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.10/dist/css/bootstrap-select.min.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.10/dist/js/bootstrap-select.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/timepicker/1.3.5/jquery.timepicker.min.js"></script>
	<style>
		div.dropdown-menu.show { width: 100% !important; } ul.dropdown-menu.inner>li>a { white-space: initial; }
	</style>
</head>
<body onload="init()">

<nav class="navbar bg-dark navbar-dark"> 
  <ul class="navbar-nav">
	<li class="nav-item">
	  <a class="navbar-brand" href="./index.html">Gesundbrunnen Raid Tool</a>
	</li>
  </ul>
  <ul class="navbar-nav ml-auto">
    <li class="nav-item">
      <select class="form-control" id="lang" onchange="changeLang()">
  		<option value="de">🇩🇪</option>
  		<option value="en">🇬🇧</option>
	</select>
    </li>
  </ul>
</nav>

<div class="container-fluid mt-2">

<ul class="nav nav-tabs mb-2">
  <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#raidtool">Raids</a></li>
  <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#telegram">Telegram</a></li>
  <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#checklist">Checklist</a></li>
</ul>

<div class="tab-content">
<div class="tab-pane active" id="raidtool">
<p><span id="txt_beta">Achtung, dies ist die Beta Seite. Funktionen sind eventuell beeinträchtigt und fehlerhaft.</span><br>
<a id="txt_mainlink" href="https://gesundbrunnen-raids.tk/">Zur Hauptseite</a></p>

<div class="form-row">
<div class="form-group col-sm-4 mb-3">
<label for="raid" class="mr-sm-2">Raid:</label>
<select class="form-control selectpicker mr-sm-2" onchange="TierCheck()" id="raid">
</select>
</div>
<div class="form-group col-sm-8 mb-3">
<label for="gym" class="mr-sm-2" id="txt_gym">Arena:</label>
<select class="form-control selectpicker mr-sm-2" data-live-search="true" data-none-results-text="Keine Ergebnisse / No result." id="gym">
</select>
</div>
</div>
<div class="form-row">
<div class="form-group col mb-3">
<label for="time" id="txt_hatch">Schlüpfzeit:</label>
<input type="text" class="form-control timepicker" id="time" autocomplete="off"></input>
<small class="form-text text-danger" id="timeh"></small>
</div>
<div class="form-group col mb-3">
<label for="start" id="txt_start">Startzeit:</label>
<input type="text" class="form-control timepicker" id="start" autocomplete="off"></input>
<small class="form-text text-danger" id="starth"></small>
</div>
</div>

<div class="form-group">
<label for="player" id="txt_player">Teilnehmer:</label>
<textarea class="form-control" id="player" rows="3" autocomplete="off"></textarea>
</div>

<div class="mb-2"><span id="txt_instr">Drücke auf "Start!", überprüfe deine Angaben und drücke dann auf "In WhatsApp posten".<br></span>
<span hidden id="txt_multi">Um einen Multiraid zu posten, ändere jetzt die Angaben oben für den nächsten Raid und drücke dann auf "Multiraid!". Wiederhole dies, bis alle Raids eingetragen sind.<br></span></div>


<div class="mb-3">
<button class="btn btn-primary" id="starter" onclick='generateRaid("")'>Start!</button>
<span hidden id="addRaid"><button class="btn btn-secondary" onclick="addRaid()">Multiraid!</button></span>
<span id="raidwarn" class="text-danger ml-2 align-middle"></span>


<div id="ex"></div>
<div id="but"></div>
</div>
</div>

<div class="tab-pane fade" id="telegram">
  <div class="fluid-container mb-3">
  <textarea class="form-control mb-3" id="tg_paste" rows="10"></textarea>
  <button class="btn btn-primary" id="tg_start" onclick="pasteTelegram()">Start!</button>
  <span id="tg_warn" class="text-danger ml-2 align-middle"></span>
  <span id="tg_output"></span>
  </div>
</div>

<div class="tab-pane fade" id="checklist">
  <div class="fluid-container mb-3">
  <textarea class="form-control mb-3" id="cl_paste" rows="10"></textarea>
  <button class="btn btn-primary" id="cl_start" onclick="createChecklist()">Start!</button>
  <span id="cl_output" hidden>
  <div id="cl_b" class="input-group mb-1">
      <input type="text" class="form-control" id="cl_v" value="Hi" readonly>
      <div class="input-group-append">
		<button class="btn btn-success" type="button" onclick="deletePlayer(this)">&check;</button>
      </div>
  </div></span>
  </div>
</div>

</div>

<p class="small"><a href="" data-toggle="modal" data-target="#changelog">Changelog</a> - <a href="" data-toggle="modal" data-target="#credits">Credits</a> - This website is not affiliated with Niantic or Nintendo. Pokémon And All Respective Names are Trademark & © of Nintendo 1996-2019.</p>

</div>

<div class="modal fade" id="credits">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Credits</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <h5>Special Thanks to:</h5>
		<ul>
			<li>WirEinmaligen (Beta Testing, bug hunting)</li>
			<li>anaron12 (Beta Testing)</li>
			<li>CptLuckyPunch (Beta Testing)</li>
			<li>Gudoran (iOS Beta Testing)</li>
		</ul>
		This Website uses the following dependencies:
		<ul>
			<li><a href="https://getbootstrap.com">Bootstrap 4.3.1</a></li>
			<li><a href="https://developer.snapappointments.com/bootstrap-select">Bootstrap-select 1.13.10</a></li>
			<li><a href="https://jquery.com">jQuery 3.3.1</a></li>
			<li><a href="https://timepicker.co">jQuery Timepicker 1.3.5</a></li>
			<li><a href="https://popper.js.org">Popper 1.14.7</a></li>
		</ul>
		Made by kimahree<br><small id="credits-ver"></small>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" id="txt_cre_close">Schließen</button>
      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="changelog">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Changelog</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div id="changelog-txt" class="modal-body">
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" id="txt_cl_close">Schließen</button>
      </div>

    </div>
  </div>
</div>


<script>
var t5multi = 0;
var t4index = 0;

var txtid = ["txt_beta","txt_mainlink","txt_lang","txt_gym","txt_hatch","txt_start","txt_player","txt_instr","txt_button","txt_multi","txt_chgym","txt_cre_close","txt_cl_close"];

var txt_de = ["Achtung, dies ist die Beta Seite. Funktionen sind eventuell beeinträchtigt und fehlerhaft.",
"Zur Hauptseite",
"Sprache:",
"Arena:",
"Schlüpfzeit:",
"Startzeit:",
"Teilnehmer:",
'Drücke auf "Start!", überprüfe deine Angaben und drücke dann auf "In WhatsApp posten".<br>',
"In WhatsApp posten",
'Um einen Multiraid zu posten, ändere jetzt die Angaben oben für den nächsten Raid und drücke dann auf "Multiraid!". Wiederhole dies, bis alle Raids eingetragen sind.<br>',
"Wähle eine Arena aus.",
"Schließen",
"Schließen"
];

var txt_en = ["Attention, you're currently on the beta page. Functionality might be compromised and bugged.",
"To the main site",
"Language:",
"Gym:",
"Hatch time:",
"Start time:",
"Participants:",
'Press "Start!", check your data and then press "Post in WhatsApp".<br>',
"Post in WhatsApp",
'To post a Multiraid, change the data above for the next raid and then press "Multiraid!". Repeat until all raids have been added.<br>',
"Choose a gym.",
"Close",
"Close"
];

var hatchwarn = 0;
var startwarn = 0;
var raidwarn = 0;
var tg_warn = 0;

var warn_de =["",
"Raids schlüpfen nicht vor 6 Uhr.",
"Raids schlüpfen nicht nach 22:45 Uhr.",
"Dieser Raid ist bereits abgelaufen.",
"Die Startzeit kann nicht in der Vergangenheit liegen.",
"Die Startzeit muss innerhalb von 45 Minuten nach der Schlüpfzeit sein.",
"Der Raidboss hat weniger als 5 Minuten Restzeit bei dieser Startzeit.",
"Die Startzeit kann nicht vor der Schlüpfzeit sein.",
"Du hast die maximale Anzahl an Raids für einen Multiraid erreicht.",
"Bitte wähle eine Arena aus.",
"Die Schlüpfzeit kann nicht mehr als eine Stunde in der Zukunft liegen.",
"Bitte geb eine Uhrzeit ein.",
'Das 4er Ei ist noch nicht ausgeschlüpft, bitte wähle bei Raid "4er Ei" aus.',
'Das 5er Ei ist noch nicht ausgeschlüpft, bitte wähle bei Raid "5er Ei" aus.',
"Fehler beim Einlesen der Daten",
"Bitte geb eine passende Startzeit ein."
];

var warn_en =["",
"Raids do not hatch before 6:00.",
"Raids do not hatch after 22:45.",
"This raid has already expired.",
"The start time cannot be in the past.",
"The start time has to be within 45 minutes after the hatch time.",
"There will be less than 5 minutes remaining at this start time.",
"You cannot start a raid before it hatches.",
"You have reached the maximum amount of raids for a multiraid.",
"Please choose a gym.",
"The hatch time must be within 1 hour from now.",
"Please enter a time.",
'The Tier 4 egg has not hatched yet, so please choose "Tier 4 egg" as raid.',
'The Tier 5 egg has not hatched yet, so please choose "Tier 5 egg" as raid.',
"Failed to parse the input",
"Please enter a valid start time."
];

var multi = 0;

var gymjson = {
"gyms": [
{"value":"1892 Historisches Gebäude","token":"historisches haus","map":"https://goo.gl/maps/LJthotdr7b72"},
{"value":"AEG Beamtentor","map":"https://goo.gl/maps/pCd3BJgke8B2"},
{"value":"Amtsgericht Wedding","ex":true,"map":"https://goo.gl/maps/q79rW3P5iz82"},
{"value":"Bahnhof Humboldthain","token":"s-bahnhof","map":"https://goo.gl/maps/NoMxjQmX8Yz"},
{"value":"Bahnsteig S-Bahnhof Gesundbrunnen","map":"https://goo.gl/maps/P6fLg6nSaKM2"},
{"value":"Balance on the Globe","tg":"Balance On The Globe","map":"https://goo.gl/maps/bM2QWrCkDhq"},
{"value":"Berliner Mauer S Wollankstraße","token":"s-bahnhof","map":"https://goo.gl/maps/7ggyACh3c7y"},
{"value":"Birkenmural","map":"https://goo.gl/maps/LUjPLZgELHR2"},
{"value":"Bornholmer Straße Border Crossing","map":"https://goo.gl/maps/borFEx1Zp3D2"},
{"value":"Bösebrücke Bornholmer Straße","map":"https://goo.gl/maps/Fkb2uqJf8kJ2"},
{"value":"Brunnen DRK","tg":"Brunnen","map":"https://goo.gl/maps/WqegcLtthPx"},
{"value":"Brunnenstraße","token":"u-bahnhof voltastraße","map":"https://goo.gl/maps/QEN9FksYAUR2"},
{"value":"Bunker Humboldthain","map":"https://goo.gl/maps/Q5xj3TTdQfR2"},
{"value":"Caritas Berlin","map":"https://goo.gl/maps/hETMiMPwxyo"},
{"value":"Drei-Säulen-Brunnen","map":"https://goo.gl/maps/BD6HAd3WwAC2"},
{"value":"Eingangstor St. Elisabeth","token":"friedhof kirchhof cemetery graveyard","map":"https://goo.gl/maps/6WQqtbYTLFD2"},
{"value":"Ente","ex":true,"token":"🦆","map":"https://goo.gl/maps/9BhrrYtz8432"},
{"value":"Ernst Reuter Büste","map":"https://goo.gl/maps/c3bK2hVWqy32"},
{"value":"Ev. Stephanus Kirche","map":"https://goo.gl/maps/Yxwu2ubRmm52"},
{"value":"Gedenkstein Opfer der Berliner Mauer","map":"https://goo.gl/maps/vKCJtW7CXjm"},
{"value":"Gewachsen auf Beton Mural","token":"u-bahnhof pankstraße","map":"https://goo.gl/maps/8MVUihQXCQ82"},
{"value":"Haus Graffiti","map":"https://goo.gl/maps/NJWvyGY1xN22"},
{"value":"Hausmalerei","map":"https://goo.gl/maps/wJXuVvpzvTv"},
{"value":"Hauswächter","map":"https://goo.gl/maps/Yv9g8aRw9S72"},
{"value":"Hippo Fountain","ex":true,"map":"https://goo.gl/maps/zRQmhYSnYTG2"},
{"value":"Humboldtpark","map":"https://goo.gl/maps/L6gci4KrmRM2"},
{"value":"Jungfräulich Maria St.","tg":"jungfräulich Maria St.","token":"sankt petrus bellermannstraße","map":"https://goo.gl/maps/4qMqQB4rPXG2"},
{"value":"Jux und Tollerei","map":"https://goo.gl/maps/vLZcbgbGXrD2"},
{"value":"Kamel","ex":true,"token":"🐫 🐪","map":"https://goo.gl/maps/xCWVtJhqw1r"},
{"value":"Kulturverein Christiana","map":"https://goo.gl/maps/Mks22S8syUn"},
{"value":"Mother Statue","map":"https://goo.gl/maps/obrXpaCe8Kp"},
{"value":"Phantom der Lichtburg","map":"https://goo.gl/maps/SrWT2D8UXxy6Y1XQ6"},
{"value":"Portal zur Kaiser Wilhelm und Augusta Stiftung","tg":"Portal zur Kaiser Wilhelm Und Augusta Stiftung","map":"https://goo.gl/maps/Z132sxwCnHE2"},
{"value":"Rosengarten am Humboldthain","tg":"Rosengarten am Humboldhain","map":"https://goo.gl/maps/uuFsiJBmDp72"},
{"value":"S-Bahnhof Bornholmer Straße","map":"https://goo.gl/maps/fTpjjxxPXbK2"},
{"value":"Shadow People","map":"https://goo.gl/maps/PzqU2mtenL42"},
{"value":"Spinnennetz Spielplatz","token":"🕸️","map":"https://goo.gl/maps/vKtfoyDAsoS2"},
{"value":"Springbrunnen am Rathaus","tg":"Springbrunnen Am Rathaus","map":"https://goo.gl/maps/j5WL5s81k2K2"},
{"value":"St. Sebastian-Kirche","ex":true,"map":"https://goo.gl/maps/za2Fq6XPC5t"},
{"value":"Stolpersteine Georg und Rudolf Juliusburger","tg":"Stolpersteine Georg Und Rudolf Juliusburger","token":"jüdisches krankenhaus jewish hospital","map":"https://goo.gl/maps/kPsKT4sGpPK2"},
{"value":"Stone Snake","token":"🐍","map":"https://goo.gl/maps/1vVp7mPAtzH2"},
{"value":"Swinemünder Brücke","map":"https://goo.gl/maps/hH2WCCHeLwK2"},
{"value":"The Real Old Mechanical Door","map":"https://goo.gl/maps/WvKP2eCWdu12"},
{"value":"U-Bahnhof Osloer Straße","tg":"U-Bahnhof Osloer Strasse","map":"https://goo.gl/maps/67rcURgu1Y82"},
{"value":"Vergessene Brücke","map":"https://goo.gl/maps/NTR2AcNt6pp"},
{"value":"Wyndham Garden Entrance Relief","token":"hotel","map":"https://goo.gl/maps/o2XreJkiJTx"},
{"value":"Zwillingsstatue","ex":true,"map":"https://goo.gl/maps/q1rctADEE8q"}
]};

var raidjson = {
	"tier5":[
		{"value":"Selfe","en":"Uxie","style":"background: #ffe763;"},
		{"value":"Tobutz","en":"Azelf","style":"background: #73ade7;"},
		{"value":"Vesprit","en":"Mesprit","style":"background: #ff8ca5;"}
	],
	"tier4":[
		{"value":"Alola-Knogga","en":"Alolan Marowak"},
		{"value":"Despotar","en":"Tyranitar"},
		{"value":"Glurak","en":"Charizard"},
		{"value":"Relaxo","en":"Snorlax"}
	]
};

var changelogjson = {
	"items": [
		{"ver":"1.0.13","date":"08.05.2019","change":["Change Raid Bosses (Detective Pikachu Event)","Fix bug when hatch time is empty"]},
		{"ver":"1.0.12","date":"02.05.2019","change":["Change Raid Bosses (Lake Trio Arrival)"]},
		{"ver":"1.0.11","date":"01.05.2019","change":["Update Bootstrap-select to fix bug on iOS","Force reload after 12 hours to fix caching issues","Load changelog from JSON and only show the first 4 entries"]},
		{"ver":"1.0.10","date":"29.04.2019","change":["Change Raid Bosses (Earth Day Event)"]},
		{"ver":"1.0.9","date":"23.04.2019","change":["Remove Latios"]},
		{"ver":"1.0.8","date":"20.04.2019","change":['Add new gym "Stone Snake"']},
		{"ver":"1.0.7","date":"15.04.2019","change":["Add Latios","Load Raids and Gyms from JSON"]},
		{"ver":"1.0.6","date":"10.04.2019","change":["Change Raid Bosses (End of Bug Event)"]},
		{"ver":"1.0.5","date":"08.04.2019","change":["Add a warning, when you try to schedule a raid without entering a start time."]},
		{"ver":"1.0.4","date":"05.04.2019","change":['Add new gym "Caritas Berlin"',"Adjust Raid end time again"]},
		{"ver":"1.0.3","date":"02.04.2019","change":["Change Raid Bosses (Giratina Origin Form, Start of Bug Event)"]},
		{"ver":"1.0.2","date":"01.04.2019","change":["Adjust Raid end time"]},
		{"ver":"1.0.1","date":"31.03.2019","change":["Fix Daylight Savings / Timezone Bug"]},
		{"ver":"1.0","date":"29.03.2019","change":["Initial Release"]}
	]
};


var raid_de = [];
var raid_en = [];
var tg_gymedit = [];
var tg_gymnew = [];

function init() {
	// make Raids
	var txt = "";
	var t4 = 0;
	var t5 = 0;
	try {
		t5 = raidjson.tier5.length;
	} catch {}
	if (t5 > 0) {
		txt += '<optgroup label="5er"><option ';
		if (t5 == 1) {
			txt += "hidden disabled ";
		}
		txt += 'value="5er" style="font-style:italic">5er Ei</option>';
		raid_de.push("5er Ei");
		raid_en.push("Tier 5 Egg");
		for (i = 0; i < t5; i++) {
			var d = (raidjson.tier5[i].de) ? raidjson.tier5[i].de:raidjson.tier5[i].value;
			var e = (raidjson.tier5[i].en) ? raidjson.tier5[i].en:raidjson.tier5[i].value;
			var s = (raidjson.tier5[i].style) ? 'style="' + raidjson.tier5[i].style + '" ':"";
			txt += '<option ' + s + 'value="' + raidjson.tier5[i].value + '">' + d + '</option>';
			raid_de.push(d);
			raid_en.push(e);
		}
		txt += '</optgroup>'
	}
	try { 
		t4 = raidjson.tier4.length; 
	} catch {}
	if (t4 > 0) {
		txt += '<optgroup label="4er"><option ';
		if (t4 == 1) {
			txt += "hidden disabled ";
		}
		txt += 'value="4er" style="font-style:italic">4er Ei</option>';
		raid_de.push("4er Ei");
		raid_en.push("Tier 4 Egg");
		for (i = 0; i < t4; i++) {
			var d = (raidjson.tier4[i].de) ? raidjson.tier4[i].de:raidjson.tier4[i].value;
			var e = (raidjson.tier4[i].en) ? raidjson.tier4[i].en:raidjson.tier4[i].value;
			txt += '<option value="' + raidjson.tier4[i].value + '">' + d + '</option>';
			raid_de.push(d);
			raid_en.push(e);
		}
		txt += '</optgroup>'
	}
	if (!txt) {
		txt = '<option selected disabled value="" style="font-style:italic">Keine Raids verfügbar.</option>';
		raid_de.push("Keine Raids verfügbar.");
		raid_en.push("No raids available.")
	}
	document.getElementById("raid").innerHTML = txt;
	
	if (t5 > 1) {
		t5multi = 1;
	}
	t4index = (t4) ? t5+1:0;
	
	// make Gym list
	
	var txt = "";
	for (i = 0; i < gymjson.gyms.length ; i++) {
		txt += '<option value="' + gymjson.gyms[i].value + '"';
		if (gymjson.gyms[i].token || gymjson.gyms[i].ex) {
			txt += ' data-tokens="';
			txt += (gymjson.gyms[i].token) ? gymjson.gyms[i].token:"";
			txt += (gymjson.gyms[i].ex) ? ' ex raid arena gym" style="font-weight:bold"':'"';
		}
		txt += '>' + gymjson.gyms[i].value;
		txt += (gymjson.gyms[i].ex) ? ' (EX)':"";
		txt += '</option>';
		if (gymjson.gyms[i].tg) {
			tg_gymedit.push(gymjson.gyms[i].tg);
			tg_gymnew.push(gymjson.gyms[i].value);
		}	
	}
	txt += '<option id="txt_chgym" value="" disabled selected hidden>Wähle eine Arena aus.</option>'
	document.getElementById("gym").innerHTML = txt;
	
	// make Changelog and add version to credits
	
	txt = "";
	for (i = 0; i < changelogjson.items.length; i++) {
		txt += "v" + changelogjson.items[i].ver + " (" + changelogjson.items[i].date +")";
		if (i == 0) {
			document.getElementById("credits-ver").innerHTML = txt;
		}
		txt += "<ul>";
		for (j=0; j < changelogjson.items[i].change.length; j++) {
			txt += "<li>" + changelogjson.items[i].change[j] + "</li>";
		}
		txt += "</ul>";
		if (i == 3) {
			txt += '<div id="changelog-txt-more" class="collapse">'
		}
	}
	txt += '</div><button id="changelog-expand" type="button" class="btn btn-primary" data-toggle="collapse" data-target="#changelog-txt-more" onclick="deleteElement(this)">Show entire Changelog</button>'
	
	document.getElementById("changelog-txt").innerHTML = txt;
	
	$('.selectpicker').selectpicker('refresh');
}

function generateRaid(raidtext) {
  document.getElementById("ex").innerHTML = "";
  document.getElementById("but").innerHTML = "";

  var text = raidtext;
  var gym = document.getElementById("gym").value;
  
  if (!gym) {
    raidwarn = 9;
	if (getLang() == "de") {
		document.getElementById("raidwarn").innerHTML = warn_de[9];
	}
	if (getLang() == "en") {
		document.getElementById("raidwarn").innerHTML = warn_en[9];
	}
	if (raidtext == "" && !document.getElementById("addRaid").getAttributeNode("hidden")) {
	    var hid3 = document.createAttribute("hidden");
		document.getElementById("addRaid").setAttributeNode(hid3);
	}
	return;
  }
  
  var raid = document.getElementById("raid").value;
  var time = document.getElementById("time").value;
  var start = document.getElementById("start").value;
  var diff = (new Date("Jan 01 1970 "+start).getTime() - new Date("Jan 01 1970 "+time).getTime()) / 60000;
  var player = document.getElementById("player").value;
  player = player.replace(/\n/g,"<br>")
  
  if (player && (!start || (startwarn != 0 && startwarn != 6) ) ) {
	raidwarn = 15;
	if (getLang() == "de") {
		document.getElementById("raidwarn").innerHTML = warn_de[15];
	}
	if (getLang() == "en") {
		document.getElementById("raidwarn").innerHTML = warn_en[15];
	}
	if (raidtext == "" && !document.getElementById("addRaid").getAttributeNode("hidden")) {
	    var hid3 = document.createAttribute("hidden");
		document.getElementById("addRaid").setAttributeNode(hid3);
	}
	return;
  }
  
  if (raidtext == "") { 
	multi = 1;
	var hid = document.getElementById("addRaid").getAttributeNode("hidden");
	if (hid) {
		document.getElementById("addRaid").removeAttributeNode(hid);
	}
	var hid1 = document.getElementById("txt_multi").getAttributeNode("hidden");
	if (hid1) {
		document.getElementById("txt_multi").removeAttributeNode(hid1);
	}
	if (!document.getElementById("txt_instr").getAttributeNode("hidden")) {
		var hid2 = document.createAttribute("hidden");
		document.getElementById("txt_instr").setAttributeNode(hid2);
	}
  }
  
  if (multi == 2) {
	text = "🚨 <b>DOPPELRAID</b> 🚨<br>" + text;
  }
  
  if (multi == 3) {
	text = text.replace("DOPPELRAID","TRIPLERAID");
  }
  
  if (multi == 4) {
	text = text.replace("🚨 <b>TRIPLERAID</b> 🚨","🚂 <b>RAID-TRAIN</b> 🚂");
  }
  
  if (multi == 7) {
	text = text.replace("RAID-TRAIN","CRAZY RAID-TRAIN");
  }
  
  
  
  if (gymjson.gyms[document.getElementById("gym").selectedIndex].ex) {
    text += "🎗 <b>EX-Raid Arena</b> 🎗 <br>";
  }
  
  text += "<b>" + raid + " " + gym + "</b> ";
  
  if (time) {
	text += "(🐣" + time + ")";
  }
  
  text += "<br>" + gymjson.gyms[document.getElementById("gym").selectedIndex].map;

  text += "<br><br><b>Start:</b> ";
   
  if ((diff <= 45 && diff >= 0) || (time == "" && start != "") || startwarn == 11) {
	text += start;
  } else {
    text += "?";
  }
  text += "<br><br>" + player
  
  var exc = document.createAttribute("class");
  exc.value = "m-3 p-2 border rounded bg-light";
  document.getElementById("ex").setAttributeNode(exc);
  
  document.getElementById("ex").innerHTML = text;
  
  var text2 = text.replace(/<br>/g,"\n");
  text2 = text2.replace(/<b>/g,"*");
  text2 = text2.replace(/<\/b>/g,"*");
  
  var n = encodeURIComponent(text2);
  var bu = document.createElement("BUTTON");
  
  var btt1 = document.createAttribute("onclick");
  btt1.value = "location.href='https://api.whatsapp.com/send?text=" + n + "';";
  bu.setAttributeNode(btt1);
  
  var btt2 = document.createAttribute("class");
  btt2.value = "btn btn-success";
  bu.setAttributeNode(btt2);
  
  var btt3 = document.createAttribute("id");
  btt3.value = "txt_button";
  bu.setAttributeNode(btt3);
  
  if (getLang() == "de") {
	var bt = document.createTextNode(txt_de[8]);
  }
  if (getLang() == "en") {
	var bt = document.createTextNode(txt_en[8]);
  }
  bu.appendChild(bt);
  
  document.getElementById("but").appendChild(bu);
 
  
  if (raidwarn != 0) {
	raidwarn = 0;
	document.getElementById("raidwarn").innerHTML = "";
  }
}

function addRaid() {
  multi++;
  var ol = document.getElementById("ex").innerHTML;
  var old = ol + "<br><br>";
  generateRaid(old);
  if (raidwarn != 0) {
	multi--;
	document.getElementById("ex").innerHTML = ol;
  }
  if (multi >= 10) {
	raidwarn = 8;
	var dsbl = document.createAttribute("hidden");
	dsbl.value = true;
	document.getElementById("addRaid").setAttributeNode(dsbl);
	if (getLang() == "de") {
		document.getElementById("raidwarn").innerHTML = warn_de[8];
	}
	if (getLang() == "en") {
		document.getElementById("raidwarn").innerHTML = warn_en[8];
	}
  }
}

function checkTime() {
  var now = new Date();
  var now2 = new Date(now.toDateString());
  var ti = document.getElementById("time").value;
  var st = document.getElementById("start").value;
  var ra = document.getElementById("raid").selectedIndex;
  var hat = new Date("Jan 01 1970 "+ti);
  var sta = new Date("Jan 01 1970 "+st);
  now -= now.getTimezoneOffset()*60000;
  now2 -= now2.getTimezoneOffset()*60000;
  hat = hat.getTime() - hat.getTimezoneOffset()*60000;
  sta = sta.getTime() - sta.getTimezoneOffset()*60000;
  now2 = now - now2;
  
  if (ti) {
	var hat2 = hat - now2;
	ti = ti.substr(0,1)
	if (ti != "0" && ti != "1" && ti != "2") {
		hatchwarn = 11;
		document.getElementById("time").value = null;
	} else if (hat < 21600000) {
		hatchwarn = 1;
	} else if (hat > 81900000) {
		hatchwarn = 2;
	} else if (hat2 < -2700000) {
		hatchwarn = 3;
	} else if (hat2 > 3600000) {
		hatchwarn = 10;
	} else if (hat2 > 0 && ra > t4index) {
		hatchwarn = 12;
	} else if (t5multi && hat2 > 0 && ra > 0) {
		hatchwarn = 13;
	} else {
		hatchwarn = 0;
	}
	
	if (getLang() == "de") {
	document.getElementById("timeh").innerHTML = warn_de[hatchwarn];
	}
	if (getLang() == "en") {
	document.getElementById("timeh").innerHTML = warn_en[hatchwarn];
	}
	
  }
  
  if (st) {
	var now3 = sta - now2;
	hat = (ti != "") ? sta - hat:0;
	
	var ste = document.createAttribute("class");
	ste.value = "form-text text-danger";
	
	st = st.substr(0,1)
	if (st != "0" && st != "1" && st != "2") {
		startwarn = 11;	
	} else if (now3 < 0) {
		startwarn = 4;
	} else if (hat >= 2700000) {
		startwarn = 5;
	} else if (hat > 2400000) {
		ste.value = "form-text text-muted";
		startwarn = 6;
	} else if (hat < 0) {
		startwarn = 7;
	} else {
		startwarn = 0;
	}
	
	if (getLang() == "de") {
		document.getElementById("starth").innerHTML = warn_de[startwarn];
	}
	if (getLang() == "en") {
		document.getElementById("starth").innerHTML = warn_en[startwarn];
	}
	document.getElementById("starth").setAttributeNode(ste);
  }
}

function checkGym(ext) {
  return ext == this;
}

function changeLang() {
  var i
  if (getLang() == "de") {
	for (i = 0; i < txtid.length; i++) {
		try {
			document.getElementById(txtid[i]).innerHTML = txt_de[i];
		} catch {}
	}
	for (i = 0; i < raid_de.length; i++) {
		if (raid_en[i] != raid_de[i]) {
			document.getElementById("raid").options[i].innerHTML = raid_de[i];
		}
	}
	document.getElementById("timeh").innerHTML = warn_de[hatchwarn];
	document.getElementById("starth").innerHTML = warn_de[startwarn];
	document.getElementById("raidwarn").innerHTML = warn_de[raidwarn];
	document.getElementById("tg_warn").innerHTML = warn_de[tg_warn];
	
	$('.selectpicker').selectpicker('refresh');
  }
  if (getLang() == "en") {
	for (i = 0; i < txtid.length; i++) {
		try {
			document.getElementById(txtid[i]).innerHTML = txt_en[i];
		} catch {}
	}	
	for (i = 0; i < raid_en.length; i++) {
		if (raid_en[i] != raid_de[i]) {
			document.getElementById("raid").options[i].innerHTML = raid_en[i];
		}
	}
	document.getElementById("timeh").innerHTML = warn_en[hatchwarn];
	document.getElementById("starth").innerHTML = warn_en[startwarn];
	document.getElementById("raidwarn").innerHTML = warn_en[raidwarn];
	document.getElementById("tg_warn").innerHTML = warn_en[tg_warn];
	
	$('.selectpicker').selectpicker('refresh');
  }
}

function getLang() {
	return document.getElementById("lang").value;
}

function TierCheck() {
	var ind = document.getElementById("raid").selectedIndex;
	if (hatchwarn == 12 && (ind == t4index || ind === 0 || (!t5multi && ind == 1))) {
		hatchwarn = 0;
		document.getElementById("timeh").innerHTML = "";
	}
	if (ind > t4index && document.getElementById("time").value) {
		checkTime();
	}
	if (t5multi) {
		if (hatchwarn == 13 && (ind === 0 || ind == t4index)) {
			hatchwarn = 0;
			document.getElementById("timeh").innerHTML = "";
		}
		if (ind > 0 && ind < t4index && document.getElementById("time").value) {
			checkTime();
		}
	}
}

function pasteTelegram() {
	var tele = document.getElementById("tg_paste").value
	var arr = tele.split("\n");
	var txt = "";
	var del = 0;
	var st_m = ""; 
	var c_m = "";
	var i_m = 0; 
	var p_m = "";
	for (i=0; i < arr.length; i++) {
		item = arr[i];
		if (item == "" || item.includes("Spieler") || item.includes("EX-RAID") || item.includes("WP-Range:") || item.includes("[0]")) {
			// check for certain terms to identify and delete empty lines, extra players, CP-Range, Ex-Raid tag & empty start times
			arr.splice(i,1);
			i--;
				
		} else if (i == 0 && item.includes("👤")) {
			// if this is the first not-empty line: get Raidboss and either get hatch time or calculate depending on post format
			var line = arr[i].split(" ");
			var g = 1;
			document.getElementById("raid").value = line[g];
			g++;
			if (line[g] == "Ei") { g++ }
			if (line[g] == "bis") {	
				g++;
				var hatchtime = new Date(new Date("Jan 01 1970 "+line[g])- 2700000);
				hatchtime = hatchtime.getHours() + ":" + hatchtime.getMinutes();
			} else {
				hatchtime = line[g];
			}
			document.getElementById("time").value = hatchtime;
			
		} else if (item.includes("Arena:")) {
			// check for gym term, then extract gym name and modify it
			var tg_gym = arr[i].substring(8,arr[i].length-2);
			var tg_gi = tg_gymedit.findIndex(checkGym,tg_gym);
			if (tg_gi >= 0) {
				document.getElementById("gym").value = tg_gymnew[tg_gi];
			} else {
				document.getElementById("gym").value = tg_gym;
			}
			
		} else if (item.includes("#")) {
			// check for # as this indicates the start times, extract time and number of participants
			del = 0;
			var starttime = arr[i].substr(2,5);
			var c = arr[i].substr(9,2);
			if (c[1] == "]") {
				c = "0"+c[0]; // we are comparing strings, so we have to make e.g. "9" into "09"
			}
			if (st_m) { // check if there are more than one start times
				if (c_m >= c) {
					// former start time has more or equal participants,  so delete the current start time and mark participants for deletion
					del = 1;
					arr.splice(i,1);
					i--;
				} else {
					// former start time has less participants, so delete the former start time and their participants
					for (j=i_m; j < i; i--) {
						console.log("Array:"+j+" deleting old line: " + arr[j]);
						arr.splice(j,1);
					}
				}
			}
			if (del == 0 || i == i_m) {
				st_m = starttime;
				c_m = c;
				i_m = i;
				p_m = "";
			}
		} else if (item.includes("└")) {
			if (del == 1) {
				// Player is marked for deletion, so delete them
				arr.splice(i,1);
				i--;
			} else {
				// delete Telegram username, then add (Telegram) and put it into the player list
				item = item.replace(/\s\(@\w+\)/,"");
				p_m += item.substr(2)+" (Telegram)\n";
			}
		}
		
	}
	

	document.getElementById("start").value = st_m;
	document.getElementById("player").value = p_m;

	$('.selectpicker').selectpicker('refresh');
	
	generateRaid("");
	
	if (raidwarn == 9) {
		tg_warn = 14;
		if (getLang() == "de") {
			document.getElementById("tg_warn").innerHTML = warn_de[tg_warn];
		}
		if (getLang() == "en") {
			document.getElementById("tg_warn").innerHTML = warn_en[tg_warn];
		}
	} else if (tg_warn == 14) {
		tg_warn = 0;
		document.getElementById("tg_warn").innerHTML = "";
	}
	
	var output = document.getElementById("tg_output");
	while (output.hasChildNodes()) {
		output.removeChild(output.firstChild);
	}
	
	if (tg_warn == 0) {
	var cln1 = document.getElementById("ex").cloneNode(true);
	document.getElementById("tg_output").appendChild(cln1);
	
	var cln2 = document.getElementById("but").cloneNode(true);
	document.getElementById("tg_output").appendChild(cln2);
	}
}

function createChecklist(){
	var cl_h1 = document.createAttribute("hidden");
	document.getElementById("cl_paste").setAttributeNode(cl_h1);
	var cl_h2 = document.createAttribute("hidden");
	document.getElementById("cl_start").setAttributeNode(cl_h2);	
	var cl_h3 = document.getElementById("cl_output").getAttributeNode("hidden");
	document.getElementById("cl_output").removeAttributeNode(cl_h3);	
	var cl = document.getElementById("cl_paste").value.split("\n");
	document.getElementById("cl_v").value = cl[0];
	for (i=1; i < cl.length; i++) {
		var cln = document.getElementById("cl_b").cloneNode(true);
		cln.getElementsByTagName("input").cl_v.value = cl[i];
		document.getElementById("cl_output").appendChild(cln);
	}
}

function deletePlayer(pla){
	pla.parentNode.parentNode.parentNode.removeChild(pla.parentNode.parentNode);
}

function deleteElement(ele){
	ele.parentNode.removeChild(ele);
}

$(document).ready(function(){
    $('input.timepicker').timepicker({});
});

$('.timepicker').timepicker({
    timeFormat: 'HH:mm',
    interval: 5,
    defaultTime: '',
	startTime: new Date(),
    dynamic: false,
    dropdown: false,
    scrollbar: false,
	change: checkTime,
});

</script>

</body>
</html>
