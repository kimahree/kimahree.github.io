<!DOCTYPE html>
<html lang="de">
<head>
	<title>Gesundbrunnen Raid Tool</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
	<meta http-equiv="refresh" content="43200">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.10/dist/css/bootstrap-select.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap-select@1.13.10/dist/js/bootstrap-select.min.js"></script>
	<style>
		div.dropdown-menu.show { width: 100% !important; } ul.dropdown-menu.inner>li>a { white-space: initial; }
	</style>
</head>
<body onload="init()">

<nav class="navbar bg-dark navbar-dark"> 
  <ul class="navbar-nav">
	<li class="nav-item">
	  <a class="navbar-brand" href="../index.html">Gesundbrunnen Raid Tool</a>
	</li>
  </ul>
  <ul class="navbar-nav ml-auto">
    <li class="nav-item">
      <select class="form-control" id="lang" onchange="changeLang()">
  		<option value="de">🇩🇪</option>
  		<option value="en">🇬🇧</option>
	</select>
    </li>
  </ul>
</nav>

<div class="container-fluid mt-2">
  <div class="row">
    <div class="col">
	  <table class="table table-striped table-sm">
	  	<thead class="thead-dark">
		  <tr>
		    <th>Alte Nestpokémon</th>
		  </tr>
		</thead>
		<tbody id="oldnest">
		</tbody>
	  </table>
	</div>
	<div class="col">
	  <table class="table table-striped table-sm">
	    <thead class="thead-dark">
		  <tr>
		    <th>Neue Nestpokémon</th>
		  </tr>
		</thead>
		<tbody id="newnest">
		</tbody>
	  </table>
	</div>
  </div>
  <div class="row mb-2">
    <div class="col-6 my-auto">
	  <select class="form-control selectpicker" data-live-search="true" data-none-results-text="Keine Ergebnisse" id="old">
      </select>
	</div>
    <!--div class="col-sm-2 my-auto">
	  <button type="button" class="btn btn-info btn-block" onclick="copyNewToOld()">Neu zu Alt</button>
	</div-->
	<div class="col-6 my-auto">
	  <select class="form-control selectpicker" data-live-search="true" data-none-results-text="Keine Ergebnisse" id="new">
      </select>
	</div>
  </div>
  <div class="row mb-2">
    <div class="col">
      <button type="button" class="btn btn-success btn-block" onclick="generateTable()">Berechnen</button>
	</div>
  </div>
  <div class="row" style="display: none;">
    <div class="col">
	  <table class="table table-bordered table-sm">
	    <thead class="thead-light">
		  <tr>
		    <th>Altes Nestpokémon</th>
			<th>Mögliche Nestpokémon</th>
		  </tr>
		</thead>
		<tbody id="nestcalc">
		</tbody>
	  </table>
	</div>
  </div>
  <div class="row mb-2" style="display: none;">
    <div class="col">
      <button type="button" class="btn btn-primary" onclick="resetList()">Zurück zum Anfang</button>
	</div>
  </div>


<p class="small"><a href="" data-toggle="modal" data-target="#changelog">Changelog</a> - <a href="" data-toggle="modal" data-target="#credits">Credits</a> - This website is not affiliated with Niantic or Nintendo. Pokémon And All Respective Names are Trademark & © of Nintendo 1996-2019.</p>

</div>

<div class="modal fade" id="credits">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Credits</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div class="modal-body">
        <h5>Special Thanks to:</h5>
		<ul>
			<li>WirEinmaligen (Beta Testing, bug hunting)</li>
			<li>anaron12 (Beta Testing)</li>
			<li>CptLuckyPunch (Beta Testing)</li>
			<li>Gudoran (iOS Beta Testing)</li>
		</ul>
		This Website uses the following dependencies:
		<ul>
			<li><a href="https://getbootstrap.com">Bootstrap 4.3.1</a></li>
			<li><a href="https://developer.snapappointments.com/bootstrap-select">Bootstrap-select 1.13.10</a></li>
			<li><a href="https://jquery.com">jQuery 3.3.1</a></li>
			<li><a href="https://timepicker.co">jQuery Timepicker 1.3.5</a></li>
			<li><a href="https://popper.js.org">Popper 1.14.7</a></li>
		</ul>
		Made by kimahree<br><small id="credits-ver"></small>
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" id="txt_cre_close">Schließen</button>
      </div>

    </div>
  </div>
</div>

<div class="modal fade" id="changelog">
  <div class="modal-dialog">
    <div class="modal-content">

      <!-- Modal Header -->
      <div class="modal-header">
        <h4 class="modal-title">Changelog</h4>
        <button type="button" class="close" data-dismiss="modal">&times;</button>
      </div>

      <!-- Modal body -->
      <div id="changelog-txt" class="modal-body">
      </div>

      <!-- Modal footer -->
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-dismiss="modal" id="txt_cl_close">Schließen</button>
      </div>

    </div>
  </div>
</div>


<script>

var pokemon = [
{"dex":1,"name":"Bisasam"},
{"dex":4,"name":"Glumanda"},
{"dex":7,"name":"Schiggy"},
{"dex":10,"name":"Raupy"},
{"dex":13,"name":"Hornliu"},
{"dex":16,"name":"Taubsi"},
{"dex":19,"name":"Rattfratz"},
{"dex":21,"name":"Habitak"},
{"dex":23,"name":"Rettan"},
{"dex":25,"name":"Pikachu"},
{"dex":27,"name":"Sandan"},
{"dex":29,"name":"Nidoran♀"},
{"dex":32,"name":"Nidoran♂"},
{"dex":35,"name":"Piepi"},
{"dex":37,"name":"Vulpix"},
{"dex":39,"name":"Pummeluff"},
{"dex":41,"name":"Zubat"},
{"dex":43,"name":"Myrapla"},
{"dex":46,"name":"Paras"},
{"dex":48,"name":"Bluzuk"},
{"dex":50,"name":"Digda"},
{"dex":52,"name":"Mauzi"},
{"dex":54,"name":"Enton"},
{"dex":56,"name":"Menki"},
{"dex":58,"name":"Fukano"},
{"dex":60,"name":"Quapsel"},
{"dex":63,"name":"Abra"},
{"dex":66,"name":"Machollo"},
{"dex":69,"name":"Knofensa"},
{"dex":72,"name":"Tentacha"},
{"dex":74,"name":"Kleinstein"},
{"dex":77,"name":"Ponita"},
{"dex":79,"name":"Flegmon"},
{"dex":81,"name":"Magnetilo"},
{"dex":83,"name":"Porenta"},
{"dex":84,"name":"Dodu"},
{"dex":86,"name":"Jurob"},
{"dex":88,"name":"Sleima"},
{"dex":90,"name":"Muschas"},
{"dex":92,"name":"Nebulak"},
{"dex":95,"name":"Onix"},
{"dex":96,"name":"Traumato"},
{"dex":98,"name":"Krabby"},
{"dex":100,"name":"Voltobal"},
{"dex":102,"name":"Owei"},
{"dex":104,"name":"Tragosso"},
{"dex":106,"name":"Kicklee"},
{"dex":107,"name":"Nockchan"},
{"dex":108,"name":"Schlurp"},
{"dex":109,"name":"Smogon"},
{"dex":111,"name":"Rihorn"},
{"dex":113,"name":"Chaneira"},
{"dex":114,"name":"Tangela"},
{"dex":115,"name":"Kangama"},
{"dex":116,"name":"Seeper"},
{"dex":118,"name":"Goldini"},
{"dex":120,"name":"Sterndu"},
{"dex":122,"name":"Pantimos"},
{"dex":123,"name":"Sichlor"},
{"dex":124,"name":"Rossana"},
{"dex":125,"name":"Elektek"},
{"dex":126,"name":"Magmar"},
{"dex":127,"name":"Pinsir"},
{"dex":128,"name":"Tauros"},
{"dex":129,"name":"Karpador"},
{"dex":131,"name":"Lapras"},
{"dex":132,"name":"Ditto"},
{"dex":133,"name":"Evoli"},
{"dex":137,"name":"Porygon"},
{"dex":138,"name":"Amonitas"},
{"dex":140,"name":"Kabuto"},
{"dex":142,"name":"Aerodactyl"},
{"dex":143,"name":"Relaxo"},
{"dex":147,"name":"Dratini"},
{"dex":152,"name":"Endivie"},
{"dex":155,"name":"Feurigel"},
{"dex":158,"name":"Karnimani"},
{"dex":161,"name":"Wiesor"},
{"dex":163,"name":"Hoothoot"},
{"dex":165,"name":"Ledyba"},
{"dex":167,"name":"Webarak"},
{"dex":170,"name":"Lampi"},
{"dex":176,"name":"Togetic"},
{"dex":177,"name":"Natu"},
{"dex":179,"name":"Voltilamm"},
{"dex":183,"name":"Marill"},
{"dex":185,"name":"Mogelbaum"},
{"dex":187,"name":"Hoppspross"},
{"dex":190,"name":"Griffel"},
{"dex":191,"name":"Sonnkern"},
{"dex":193,"name":"Yanma"},
{"dex":194,"name":"Felino"},
{"dex":198,"name":"Kramurx"},
{"dex":200,"name":"Traunfugil"},
{"dex":201,"name":"Icognito"},
{"dex":202,"name":"Woingenau"},
{"dex":203,"name":"Girafarig"},
{"dex":204,"name":"Tannza"},
{"dex":206,"name":"Dummisel"},
{"dex":207,"name":"Skorgla"},
{"dex":209,"name":"Snubbull"},
{"dex":211,"name":"Baldorfish"},
{"dex":213,"name":"Pottrott"},
{"dex":214,"name":"Skaraborn"},
{"dex":215,"name":"Sniebel"},
{"dex":216,"name":"Teddiursa"},
{"dex":218,"name":"Schneckmag"},
{"dex":220,"name":"Quiekel"},
{"dex":222,"name":"Corasonn"},
{"dex":223,"name":"Remoraid"},
{"dex":225,"name":"Botogel"},
{"dex":226,"name":"Mantax"},
{"dex":227,"name":"Panzaeron"},
{"dex":228,"name":"Hunduster"},
{"dex":231,"name":"Phanpy"},
{"dex":234,"name":"Damhirplex"},
{"dex":235,"name":"Farbeagle"},
{"dex":237,"name":"Kapoera"},
{"dex":241,"name":"Miltank"},
{"dex":246,"name":"Larvitar"},
{"dex":252,"name":"Geckarbor"},
{"dex":255,"name":"Flemmli"},
{"dex":258,"name":"Hydropi"},
{"dex":261,"name":"Fiffyen"},
{"dex":263,"name":"Zigzachs"},
{"dex":265,"name":"Waumpel"},
{"dex":270,"name":"Loturzel"},
{"dex":273,"name":"Samurzel"},
{"dex":276,"name":"Schwalbini"},
{"dex":278,"name":"Wingull"},
{"dex":280,"name":"Trasla"},
{"dex":283,"name":"Gehweiher"},
{"dex":285,"name":"Knilz"},
{"dex":287,"name":"Bummelz"},
{"dex":290,"name":"Nincada"},
{"dex":293,"name":"Flurmel"},
{"dex":296,"name":"Makuhita"},
{"dex":299,"name":"Nasgnet"},
{"dex":300,"name":"Eneco"},
{"dex":302,"name":"Zobiris"},
{"dex":303,"name":"Flunkifer"},
{"dex":304,"name":"Stollunior"},
{"dex":307,"name":"Meditie"},
{"dex":309,"name":"Frizelbliz"},
{"dex":311,"name":"Plusle"},
{"dex":312,"name":"Minun"},
{"dex":313,"name":"Volbeat"},
{"dex":314,"name":"Illumise"},
{"dex":315,"name":"Roselia"},
{"dex":316,"name":"Schluppuck"},
{"dex":318,"name":"Kanivanha"},
{"dex":320,"name":"Wailmer"},
{"dex":322,"name":"Camaub"},
{"dex":324,"name":"Qurtel"},
{"dex":325,"name":"Spoink"},
{"dex":327,"name":"Pandir"},
{"dex":328,"name":"Knacklion"},
{"dex":331,"name":"Tuska"},
{"dex":333,"name":"Wablu"},
{"dex":335,"name":"Sengo"},
{"dex":336,"name":"Vipitis"},
{"dex":337,"name":"Lunastein"},
{"dex":338,"name":"Sonnfel"},
{"dex":339,"name":"Schmerbe"},
{"dex":341,"name":"Krebscorps"},
{"dex":343,"name":"Puppance"},
{"dex":345,"name":"Liliep"},
{"dex":347,"name":"Anorith"},
{"dex":349,"name":"Barschwa"},
{"dex":351,"name":"Formeo"},
{"dex":352,"name":"Kecleon"},
{"dex":353,"name":"Shuppet"},
{"dex":355,"name":"Zwirrlicht"},
{"dex":357,"name":"Tropius"},
{"dex":358,"name":"Palimpalim"},
{"dex":359,"name":"Absol"},
{"dex":361,"name":"Schneppke"},
{"dex":363,"name":"Seemops"},
{"dex":366,"name":"Perlu"},
{"dex":369,"name":"Relicanth"},
{"dex":370,"name":"Liebiskus"},
{"dex":371,"name":"Kindwurm"},
{"dex":374,"name":"Tanhel"},
{"dex":387,"name":"Chelast"},
{"dex":390,"name":"Panflam"},
{"dex":393,"name":"Plinfa"},
{"dex":396,"name":"Staralili"},
{"dex":399,"name":"Bidiza"},
{"dex":401,"name":"Zirpurze"},
{"dex":403,"name":"Sheinux"},
{"dex":408,"name":"Koknodon"},
{"dex":410,"name":"Schilterus"},
{"dex":412,"name":"Burmy"},
{"dex":415,"name":"Wadribie"},
{"dex":417,"name":"Pachirisu"},
{"dex":418,"name":"Bamelin"},
{"dex":420,"name":"Kikugi"},
{"dex":422,"name":"Schalellos"},
{"dex":425,"name":"Driftlon"},
{"dex":427,"name":"Haspiror"},
{"dex":431,"name":"Charmian"},
{"dex":434,"name":"Skunkapuh"},
{"dex":436,"name":"Bronzel"},
{"dex":441,"name":"Plaudagei"},
{"dex":442,"name":"Kryppuk"},
{"dex":443,"name":"Kaumalat"},
{"dex":448,"name":"Lucario"},
{"dex":449,"name":"Hippopotas"},
{"dex":451,"name":"Pionskora"},
{"dex":453,"name":"Glibunkel"},
{"dex":455,"name":"Venuflibis"},
{"dex":456,"name":"Finneon"},
{"dex":459,"name":"Shnebedeck"}
];

var orignest = [1,4,7,25,35,37,43,54,58,60,63,66,72,77,81,84,86,90,92,95,100,102,104,111,116,123,124,125,126,127,129,133,138,140,152,155,158,170,185,190,193,200,202,203,206,209,211,213,215,216,220,226,227,231,234,252,255,258,261,273,278,283,285,296,299,300,302,307,309,311,312,318,320,322,325,333,341,343,345,347,353,355,370,387,390,393,399,449];
var oldnest = orignest.slice();
var newnest = oldnest.slice();

function init() {
  buildNestlist("old");
  buildNestlist("new");
  
  var txt = "";
  for (var i = 0; i < pokemon.length ; i++) {
    txt += "<option value=" + pokemon[i].dex + ">" + pokemon[i].name + "</option>"
  }
  document.getElementById("old").innerHTML = txt;
  document.getElementById("new").innerHTML = txt;
}

function buildNestlist(type) {
  var nest = eval(type + "nest");
  var txt = "";  
  for (var i = 0; i < nest.length ; i++) {
    var pk = getPkmnByDex(nest[i])[0].name;
	txt += "<tr><td>" + pk + "</td></tr>"
  }
  document.getElementById(type + "nest").innerHTML = txt;
}

function updateNestlist(type) {
  var pk = parseInt(document.getElementById(type).value);
  var ne = type + "nest";
  if (eval(ne).find(isIn,pk)) {
    eval(ne).splice(eval(ne).findIndex(isIn,pk), 1);
  } else {
    eval(ne).push(pk);
    eval(ne).sort(function(a, b){return a-b});
  }
  buildNestlist(type);
}

function generateTable() {
  var txt = "";
  var j = 1;
  var old_le = oldnest.length;
  var new_le = newnest.length;
  for (var i = 0; i < old_le ; i++) {
    var oldper = 0;
	txt += "<tr><td>" + getPkmnByDex(oldnest[i])[0].name + "</td><td>";
	do {
	  var p = (j * old_le / new_le) - i;
	  var per = (p*100).toFixed(2);
	  if (per >= 100) { 
	    per = 100;
	  }
	  if (oldper > 0) {
		per -= oldper;		
		per = per.toFixed(2);
	  }
	  if (per > 0) {
	    txt += getPkmnByDex(newnest[j-1])[0].name + " (" + per + "%)";
	  }
	  console.log(i + ", " + j + ", " + p + ", " + per + ", " + oldper);

	  if (p < 1) {
		j++;
		oldper = (oldper*10 + per*10) / 10;
		if (per > 0) {
		  txt += ", ";
		}
	  }
	}
	while (p < 1);
	txt += "</td></tr>";
  }
  document.getElementById("nestcalc").innerHTML = txt;

  $('.row').toggle();
}

function copyNewToOld() {
  oldnest = newnest.slice();
  buildNestlist("old");
}

function resetList() {
  oldnest = orignest.slice();
  newnest = orignest.slice();
  buildNestlist("old");
  buildNestlist("new");
  $('.row').toggle();
}

function getPkmnByDex(dex) {
  return pokemon.filter(
    function(pokemon){ return pokemon.dex == dex });
}

function isIn(dex) {
  return dex == this;
}

$('#old').on('hidden.bs.select', function () {
  updateNestlist("old");
});

$('#new').on('hidden.bs.select', function () {
  updateNestlist("new");
});

</script>

</body>
</html>
